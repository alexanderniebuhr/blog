# yaml-language-server: $schema=https://moonrepo.dev/schemas/project.json

type: 'application'

fileGroups:
  astro:
    - 'public/**/*'
    - 'src/**/*'
    - 'astro.config.*'

tasks:

  # Production build
  build:
    env:
      STATE: 'building'
    command: "astro build"
    inputs:
      - '@group(astro)'
    outputs:
      - 'dist'

  # Production build
  watch:
    env:
      ROARR_LOG: 'true'
    command: "turbowatch"
    options:
      persistent: true

  wrangler:
    command: 'wrangler pages dev dist --log-level debug --live-reload'
  
  # Preview production build locally
  preview:
      command: 'noop'
      deps:
        - '~:watch'
        - '~:wrangler'
      options:
        persistent: true
        cache: false
      
  # Development server
  dev:
    command: "astro dev"
    options:
      persistent: true
      cache: false

  types:
    env:
      SKIP_ENV_VALIDATION: 'true'
    command: 'astro check'
    inputs:
      - '@group(astro)'
    deps:
      - '~:typecheck'

# Disable project references
toolchain:
    typescript:
      syncProjectReferences: false
