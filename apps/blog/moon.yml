# yaml-language-server: $schema=https://moonrepo.dev/schemas/project.json

type: 'application'

fileGroups:
  astro:
    - 'public/**/*'
    - 'src/**/*'
    - 'astro.config.*'

tasks:

  # Production build
  build:
    env:
      STATE: 'building'
    command: "astro build"
    inputs:
      - '@group(astro)'
    outputs:
      - 'dist'

  # Production build
  watch:
    env:
    command: "nodemon --watch 'src/**/*' --ext astro,tsx,ts --exec \"moon run blog:build\""
    options:
      persistent: true
      cache: false

  preview:
    command: 'wrangler pages dev dist --live-reload'
    deps:
      - '~:watch'
    options: 
      persistent: true
      cache: false

  # Development server
  dev:
    command: "astro dev"
    options:
      persistent: true
      cache: false

  ccheck:
    env:
      SKIP_ENV_VALIDATION: 'true'
    command: 'astro check'
    inputs:
      - '@group(astro)'
    deps:
      - '~:typecheck'

  # types:
  #   command: 'wrangler types'
  #   options: 
  #     cache: false

# Disable project references
toolchain:
    typescript:
      syncProjectReferences: false
